<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programa Patenta</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="icon" href="./images/icon.png">
    <script src="./js/validacionForm.js"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
        #enviar {
            display: none;
        }
        /* Estilo para el contenedor del GIF de carga */
        #loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <header class="header">
        <figure>
            <img src="./images/banner.png" alt="banner">
        </figure>
    </header>
    <main class="postular">
        <h1>Formulario de participación</h1>
        <p>Completa la información solicitada y adjunta los documentos de postulación.</p>
        <!-- GIF de carga -->
        
        <form id="formulario" action="/submit" method="POST" enctype="multipart/form-data">
            <!-- Campos del formulario -->
            <label>Tipo de participante</label>
            <select name="tipo_participante" required>
                <option value="Empresa">Empresa</option>
                <option value="Centros académicos y/o investigación">Centros académicos y/o investigación</option>
                <option value="Inventor(es) independiente(s)">Inventor(es) independiente(s)</option>
            </select>
            <label>Nombre de la Institución o Empresa</label>
            <input type="text" name="nombre_institucion" required>
            <label>Título de la Invención</label>
            <input type="text" name="titulo_invencion">
            <!-- Más campos aquí -->
            <label>Ficha del postulante</label>
            <input type="file" name="ficha_postulante">
            <label>Ficha de la invención</label>
            <input type="file" name="ficha_invencion">
            <label>Acta de compromiso</label>
            <input type="file" name="acta_compromiso">
            <div class="g-recaptcha" data-sitekey="6LdUDjMqAAAAAM8e2XjbRjgOUrYPhFBJjBYtcErg" data-callback="captchaCompleted"></div>
            <input type="hidden" id="recaptcha_token" name="recaptcha_token">
            <button id="enviar" type="button">Enviar</button>
            <div id="loading">
                <img src="./images/carga.webp" alt="Cargando...">
            </div>
        </form>
    </main>

    <script>
        function captchaCompleted(token) {
            // Guardar el token de reCAPTCHA en el campo oculto
            document.getElementById('recaptcha_token').value = token;
            // Mostrar el botón de enviar
            document.getElementById('enviar').style.display = 'block';
        }

        document.getElementById('enviar').addEventListener('click', function(event) {
            // Obtener el formulario
            const formulario = document.getElementById('formulario');

            // Validar campos vacíos
            const nombreInstitucion = document.querySelector('input[name="nombre_institucion"]').value.trim();
            // Más validaciones...

            // Validar campos obligatorios
            if (!nombreInstitucion) {
                alert('Todos los campos obligatorios deben ser completados.');
                return;
            }

            // Mostrar el GIF de carga y deshabilitar el botón de envío
            document.getElementById('loading').style.display = 'block';
            document.getElementById('enviar').disabled = true;

            const formData = new FormData(document.getElementById('formulario'));

            fetch('/submit', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Ocultar el GIF de carga
                document.getElementById('loading').style.display = 'none';
                document.getElementById('enviar').disabled = false;

                if (data.success) {
                    alert(data.message);  // Mensaje de éxito
                    window.location.href = 'index.html';  // Redirigir
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Ocurrió un error al procesar la postulación.');
                // Ocultar el GIF de carga en caso de error
                document.getElementById('loading').style.display = 'none';
                document.getElementById('enviar').disabled = false;
            });
        });
    </script>
</body>
</html>
